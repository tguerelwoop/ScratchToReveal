<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { margin:0; overflow:hidden; font-family: 'Trebuchet MS', sans-serif; }

  /* Container for everything */
  .scratch-container {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    touch-action: none;
    background: rgb(255, 255, 255);
  }

  /* Bottom image + canvas */
  .scratch-container img,
  .scratch-container canvas {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 100%;
    max-height: 100%;
    display: block;
  }

  /* Intro overlay */
  .intro-screen {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: opacity 0.6s ease;
  }

  .intro-card {
    background: #EDC9D5;
    padding: 30px 40px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    animation: popIn 0.5s ease;
  }

  @keyframes popIn {
    0% { transform: scale(0.8); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }

  .intro-title {
    font-size: 28px;
    margin-bottom: 10px;
    color: #BF4068;
  }

  .intro-sub {
    font-size: 18px;
    margin-bottom: 20px;
    color: #FFF7FA;
  }

  .start-btn {
    background: #9D3455;
    color: white;
    padding: 12px 26px;
    border-radius: 30px;
    font-size: 20px;
    border: none;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.2s ease;
  }

  .start-btn:hover {
    background: #D47D99;
    transform: scale(1.05);
  }

  /* Sparkle flash */
  .sparkle {
    position: absolute;
    width: 8px;
    height: 8px;
    background: radial-gradient(circle, #ffe093, rgba(255,255,255,0));
    pointer-events: none;
    opacity: 1;
    animation: sparkleFade 0.6s linear forwards;
  }
  @keyframes sparkleFade {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(2); opacity: 0; }
  }

  /* ✨ Drifting glitter */
  .glitter {
    position: absolute;
    width: 6px;
    height: 6px;
    background: radial-gradient(circle, #ffd6ff, rgba(255,255,255,0));
    border-radius: 50%;
    pointer-events: none;
    opacity: 0.9;
    animation: glitterDrift 1.2s ease-out forwards;
  }

  @keyframes glitterDrift {
    0% { transform: translate(0, 0) scale(1); opacity: 1; }
    100% { transform: translate(var(--dx), var(--dy)) scale(0.5); opacity: 0; }
  }
</style>
</head>
<body>

<div class="scratch-container">

  <!-- Intro Screen -->
  <div class="intro-screen" id="intro">
    <div class="intro-card">
      <div class="intro-title"> scratch to reveal !</div>
      <div class="intro-sub">use your finger or mouse to uncover the surprise <3</div>
      <button class="start-btn" onclick="startScratch()">Start</button>
    </div>
  </div>

  <!-- Bottom image -->
  <img id="bottom" src="bottom.jpg" alt="">
  <!-- Top image canvas -->
  <canvas id="scratchCanvas"></canvas>
</div>

<script>
const canvas = document.getElementById('scratchCanvas');
const ctx = canvas.getContext('2d');
const bottomImgEl = document.getElementById('bottom');
const intro = document.getElementById('intro');

const topImg = new Image();
topImg.src = 'top.jpg';

/* ✨ Fade out intro screen */
function startScratch() {
  intro.style.opacity = "0";
  setTimeout(() => intro.style.display = "none", 600);
}

topImg.onload = () => {
  requestAnimationFrame(() => {
    const rect = bottomImgEl.getBoundingClientRect();

    canvas.width = rect.width;
    canvas.height = rect.height;

    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';

    ctx.globalCompositeOperation = 'source-over';
    ctx.drawImage(topImg, 0, 0, canvas.width, canvas.height);

    canvas.dataset.ready = '1';
  });
};

let drawing = false;

/* Heart-shaped erase brush */
function eraseHeart(x, y) {
  ctx.save();
  ctx.globalCompositeOperation = 'destination-out';

  const size = 20;
  ctx.translate(x, y);
  ctx.scale(size, size);

  ctx.beginPath();
  ctx.moveTo(0, -0.3);
  ctx.bezierCurveTo(0.5, -0.8, 1.3, -0.1, 0, 1);
  ctx.bezierCurveTo(-1.3, -0.1, -0.5, -0.8, 0, -0.3);
  ctx.closePath();
  ctx.fill();

  ctx.restore();
}

/* Sparkle flash */
function spawnSparkle(x, y) {
  const sparkle = document.createElement("div");
  sparkle.className = "sparkle";
  sparkle.style.left = x + "px";
  sparkle.style.top = y + "px";
  document.body.appendChild(sparkle);
  setTimeout(() => sparkle.remove(), 600);
}

/*  Drifting glitter */
function spawnGlitter(x, y) {
  const glitter = document.createElement("div");
  glitter.className = "glitter";

  const dx = (Math.random() * 60 - 30) + "px";
  const dy = (Math.random() * -60) + "px";

  glitter.style.setProperty("--dx", dx);
  glitter.style.setProperty("--dy", dy);

  glitter.style.left = x + "px";
  glitter.style.top = y + "px";

  document.body.appendChild(glitter);
  setTimeout(() => glitter.remove(), 1200);
}

function handleErase(event) {
  if (canvas.dataset.ready !== '1') return;

  const rect = canvas.getBoundingClientRect();
  const x = event.clientX - rect.left;
  const y = event.clientY - rect.top;

  eraseHeart(x, y);

  spawnSparkle(event.clientX, event.clientY);

  for (let i = 0; i < 3; i++) {
    spawnGlitter(event.clientX, event.clientY);
  }
}

/* Mouse */
canvas.addEventListener('mousedown', e => {
  drawing = true;
  handleErase(e);
});
canvas.addEventListener('mousemove', e => {
  if (drawing) handleErase(e);
});
window.addEventListener('mouseup', () => drawing = false);

/* Touch */
canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  drawing = true;
  handleErase(e.touches[0]);
});
canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  if (drawing) handleErase(e.touches[0]);
});
window.addEventListener('touchend', () => drawing = false);
</script>

</body>
</html>
